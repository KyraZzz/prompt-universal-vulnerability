# BToP/AToP

Implementation of our paper "**Exploring the Universal Vulnerability of Prompt-based Learning Paradigm**" on Findings of NAACL 2022.


![](misc/framework.png)


## Overview

Prompt-based learning is a new trend in text classification. However, this new learning paradigm has universal vulnerability, meaning that phrases that mislead a pre-trained language model can universally interfere downstream prompt-based models. In this repo, we implement two methods to inject or find these phrases.

- **Backdoor Triggers on Prompt-based Learning (BToP)** assumes that the attacker can access the training phrase of the language model. These triggers are injected to the language model by fine-tuning.
- **Adversarial Triggers on Prompt-based Learning (AToP)** assumes no access to language model training. These triggers are discovered using a beam search algorithm on off-the-shelf language models.

## Install

Please install `pytorch>=1.8.0` and correctly configure the GPU accelerator. (**GPU is required.**)

Install all requirements by

```
pip install -r requirements.txt
```

## BToP

`btop/insert_backdoor.py` implements the backdoor attack on PLMs during the pre-training stage. You can inject backoodr into PLMs by

```
python3 -m btop.insert_backdoor --sample_nums 30000 --bert_type roberta-large \
	--batch_size 32 --epochs 10 --save_path poisoned_lm
```

The backdoor injected model will be saved in the path: `poisoned_lm`. 

The arguments:

- `sample_nums`: The number of samples we sample from the general corpus.
- `bert_type`: The type of PLMs. 
- `save_path`: Path to save the backdoor injected models. 



`btop/eval.py`  evaluate the attack performance and normal accuracy:

```
python3 -m btop.eval --shots 16 --dataset ag_news --model_path poisoned_lm --target_label 1 \
	--repeat 5 --bert_type roberta-large --template_id 0 
```

The arguments:

- `shots`: The number of samples per label.
- `dataset`: The evaluation datasets. 
- `model_path`: Path to the saved backdoor injected model. 
- `target_label`: The attacker-specified label.
- `bert_type`: The type of PLMs. 
- `template_id`: The chosen template. 






## AToP

`atop/search_atop.py` implements the trigger search on RoBERTa-large model. You can search for all-purpose triggers by

```
python3 atop/search_atop.py --trigger_len 3 --trigger_pos all
```

Results will be stored in the `triggers/` folder as a JSON file.

To search for position-sensitive triggers, you can change `--trigger_pos` to 

- `prefix`: the trigger is supposed to be placed before the text.
- `suffix`: the trigger is supposed to be placed after the text.

For more arguments, see `python3 atop/search_atop.py --help`.


## Datasets and Prompts

The datasets and prompts used in experiments are in `data/` and `prompt/` folders.

## Citing BToP/AToP

If you use AToP and/or BToP, please cite the following work:

- *Lei Xu, Yangyi Chen, Ganqu Cui, Hongcheng Gao, Zhiyuan Liu.* **Exploring the Universal Vulnerability of Prompt-based Learning Paradigm.** Findings of NAACL, 2022.

```
@inproceedings{xu2022exploring,
  title={Exploring the Universal Vulnerability of Prompt-based Learning Paradigm},
  author={Xu, Lei and Chen, Yangyi and Cui, Ganqu and Gao, Hongcheng and Liu, Zhiyuan},
  booktitle={Findings of the Association for Computational Linguistics: NAACL 2022},
  year={2022}
}
```
